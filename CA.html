<html>

<head>
<style type="text/css">
.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.left {
  text-align: left;
}
.right {
  text-align: right;
}
.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<title>Correspondence Analysis (CA) ordinations with METZYME data</title>
</head>

<body>

<p>CA ordinations were created using normalizated dinoflagellate transcripts annoated at the KOG-level. The same approach was used to create dinoflagellate protein CA plots. Read in count and meta data:</p>

<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(vegan)</span>
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: permute
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: lattice
</pre></div>
<div class="message"><pre class="knitr r">## This is vegan 2.5-5
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(ggplot2)</span>
</pre></div>
<div class="message"><pre class="knitr r">## Registered S3 methods overwritten by 'ggplot2':
##   method         from 
##   [.quosures     rlang
##   c.quosures     rlang
##   print.quosures rlang
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(RColorBrewer)</span>
<span class="hl kwd">library</span><span class="hl std">(dplyr)</span>
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'dplyr'
</pre></div>
<div class="message"><pre class="knitr r">## The following objects are masked from 'package:stats':
## 
##     filter, lag
</pre></div>
<div class="message"><pre class="knitr r">## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(tibble)</span>

<span class="hl std">a</span><span class="hl kwb">&lt;-</span><span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">'C:/Users/Natalie/Documents/METZYME/transcripts 3um/TPM_TRANSCRIPTS_Dino.lpi0.8_only_annotations_KOGpost.csv'</span><span class="hl std">)</span>
<span class="hl kwd">rownames</span><span class="hl std">(a)</span><span class="hl kwb">&lt;-</span><span class="hl std">a</span><span class="hl opt">$</span><span class="hl std">X</span>
<span class="hl std">a</span><span class="hl kwb">&lt;-</span><span class="hl std">a[,</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">]</span>
<span class="hl std">data</span><span class="hl kwb">&lt;-</span><span class="hl std">a</span>
<span class="hl std">meta</span><span class="hl kwb">&lt;-</span><span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">'C:/Users/Natalie/Documents/METZYME/transcripts 3um/CCA_meta.csv'</span><span class="hl std">)</span>
<span class="hl kwd">rownames</span><span class="hl std">(meta)</span><span class="hl kwb">&lt;-</span><span class="hl std">meta</span><span class="hl opt">$</span><span class="hl std">ID</span>
<span class="hl std">meta</span><span class="hl kwb">&lt;-</span><span class="hl std">meta[,</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">]</span>
</pre></div>
</div></div>

<p>Hellinger-transform to decrease the weight given by low abundance genes, then run the CA. Summary includes proportion of variation explained by each component.</p>

<div class="chunk" id="unnamed-chunk-2"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">stand</span><span class="hl kwb">&lt;-</span><span class="hl kwd">decostand</span><span class="hl std">(data,</span> <span class="hl kwc">method</span> <span class="hl std">=</span> <span class="hl str">&quot;hellinger&quot;</span><span class="hl std">)</span> <span class="hl com">#hellinger transformed</span>
<span class="hl std">ca</span><span class="hl kwb">&lt;-</span><span class="hl kwd">cca</span><span class="hl std">(stand)</span>
<span class="hl com">#summary(ca)</span>
</pre></div>
</div></div>

<div class="chunk" id="unnamed-chunk-3"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">plot</span><span class="hl std">(ca)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-3-1.png" title="plot of chunk unnamed-chunk-3" alt="plot of chunk unnamed-chunk-3" class="plot" /></div></div>

<p>Clean metadata file and remove highly co-linear parameters (e.g., nitrate/phosphate, oxygen/temperature), and perform environmental data vector fitting.</p>

<div class="chunk" id="unnamed-chunk-4"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">meta1</span><span class="hl kwb">&lt;-</span><span class="hl std">meta</span>
<span class="hl std">meta</span><span class="hl kwb">&lt;-</span><span class="hl std">meta[,</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">]</span>
<span class="hl std">meta</span><span class="hl kwb">&lt;-</span><span class="hl std">meta[,</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">]</span>
<span class="hl std">meta</span><span class="hl kwb">&lt;-</span><span class="hl std">meta[,</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">]</span>
<span class="hl std">meta</span><span class="hl kwb">&lt;-</span><span class="hl std">meta[,</span><span class="hl opt">-</span><span class="hl num">2</span><span class="hl std">]</span>
<span class="hl std">ef</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">envfit</span><span class="hl std">(ca, meta,</span> <span class="hl kwc">permu</span> <span class="hl std">=</span> <span class="hl num">999</span><span class="hl std">)</span>
<span class="hl std">meta</span><span class="hl kwb">&lt;-</span><span class="hl std">meta1</span> <span class="hl com">#Revert back to original table with site and depth information</span>
<span class="hl std">ef</span> <span class="hl com">#Results of linear regression vector fitting</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
## ***VECTORS
## 
##                  CA1      CA2     r2 Pr(&gt;r)    
## NH4         -0.93385  0.35766 0.1055  0.107    
## NO3          0.99949 -0.03189 0.6179  0.001 ***
## Temperature -0.99733  0.07301 0.7021  0.001 ***
## Co           0.99525  0.09736 0.2619  0.006 ** 
## Fe           0.97711 -0.21275 0.5347  0.001 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## Permutation: free
## Number of permutations: 999
</pre></div>
</div></div>

<div class="chunk" id="unnamed-chunk-5"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">plot</span><span class="hl std">(ca)</span>
<span class="hl kwd">plot</span><span class="hl std">(ef)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-5-1.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" class="plot" /></div></div>

<p>In preparation for plotting, extract scores from CA output.</p>

<div class="chunk" id="unnamed-chunk-6"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">scores</span><span class="hl kwb">&lt;-</span><span class="hl kwd">scores</span><span class="hl std">(ca)</span>
<span class="hl std">scores</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">data.frame</span><span class="hl std">(ca</span><span class="hl opt">$</span><span class="hl std">CA</span><span class="hl opt">$</span><span class="hl std">u)</span>
<span class="hl std">uscores</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">inner_join</span><span class="hl std">(</span><span class="hl kwd">rownames_to_column</span><span class="hl std">(data),</span> <span class="hl kwd">rownames_to_column</span><span class="hl std">(</span><span class="hl kwd">data.frame</span><span class="hl std">(scores)),</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;right&quot;</span><span class="hl std">,</span> <span class="hl kwc">by</span> <span class="hl std">=</span> <span class="hl str">&quot;rowname&quot;</span><span class="hl std">)</span>
</pre></div>
</div></div>

<div class="chunk" id="unnamed-chunk-7"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">vscores</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.data.frame</span><span class="hl std">(</span><span class="hl kwd">scores</span><span class="hl std">(ef,</span> <span class="hl kwc">display</span> <span class="hl std">=</span> <span class="hl str">&quot;vectors&quot;</span><span class="hl std">))</span>
<span class="hl std">vscores</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">cbind</span><span class="hl std">(vscores,</span> <span class="hl kwc">Species</span> <span class="hl std">=</span> <span class="hl kwd">rownames</span><span class="hl std">(vscores))</span>
<span class="hl std">vscores</span><span class="hl opt">$</span><span class="hl std">env</span><span class="hl kwb">&lt;-</span><span class="hl kwd">rownames</span><span class="hl std">(vscores)</span>
</pre></div>
</div></div>

<p>Graph ordination with ggplot2.</p>
<div class="chunk" id="unnamed-chunk-8"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">ggplot</span><span class="hl std">(uscores)</span> <span class="hl opt">+</span> <span class="hl kwd">theme_bw</span><span class="hl std">()</span> <span class="hl opt">+</span> <span class="hl kwd">scale_shape_manual</span><span class="hl std">(</span><span class="hl kwc">values</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">21</span><span class="hl opt">:</span><span class="hl num">25</span><span class="hl std">,</span><span class="hl num">8</span><span class="hl std">,</span><span class="hl num">9</span><span class="hl std">))</span> <span class="hl opt">+</span> <span class="hl kwd">theme</span><span class="hl std">(</span><span class="hl kwc">strip.text.y</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">angle</span> <span class="hl std">=</span> <span class="hl num">0</span><span class="hl std">))</span> <span class="hl opt">+</span> <span class="hl kwd">geom_segment</span><span class="hl std">(</span><span class="hl kwc">data</span> <span class="hl std">= vscores,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">=</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">y</span> <span class="hl std">=</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">xend</span> <span class="hl std">= vscores</span><span class="hl opt">$</span><span class="hl std">CA1,</span> <span class="hl kwc">yend</span> <span class="hl std">= vscores</span><span class="hl opt">$</span><span class="hl std">CA2),</span> <span class="hl kwc">arrow</span><span class="hl std">=</span><span class="hl kwd">arrow</span><span class="hl std">(</span><span class="hl kwc">length</span><span class="hl std">=</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">0.2</span><span class="hl std">,</span><span class="hl str">&quot;cm&quot;</span><span class="hl std">)),</span>
                                                                                                                                        <span class="hl kwc">alpha</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">'black'</span><span class="hl std">)</span><span class="hl opt">+</span> <span class="hl kwd">geom_label</span><span class="hl std">(</span><span class="hl kwc">data</span><span class="hl std">=vscores,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=CA1,</span> <span class="hl kwc">y</span><span class="hl std">=CA2,</span> <span class="hl kwc">label</span> <span class="hl std">= env))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_point</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= CA1,</span> <span class="hl kwc">y</span> <span class="hl std">= CA2,</span> <span class="hl kwc">col</span> <span class="hl std">= meta</span><span class="hl opt">$</span><span class="hl std">Depth,</span>
                 <span class="hl kwc">shape</span> <span class="hl std">= meta</span><span class="hl opt">$</span><span class="hl std">Site,</span> <span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">4</span><span class="hl std">))</span> <span class="hl opt">+</span>
  <span class="hl kwd">scale_colour_gradient</span><span class="hl std">(</span><span class="hl kwc">low</span><span class="hl std">=</span><span class="hl str">&quot;#A2FEFF&quot;</span><span class="hl std">,</span><span class="hl kwc">high</span><span class="hl std">=</span><span class="hl str">&quot;black&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
  <span class="hl kwd">scale_fill_manual</span><span class="hl std">(</span><span class="hl kwc">values</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;#A2FEFF&quot;</span><span class="hl std">,</span><span class="hl str">'black'</span><span class="hl std">)</span> <span class="hl opt">+</span>
                      <span class="hl kwd">geom_segment</span><span class="hl std">(</span><span class="hl kwc">data</span> <span class="hl std">= vscores,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">=</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">y</span> <span class="hl std">=</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">xend</span> <span class="hl std">= vscores</span><span class="hl opt">$</span><span class="hl std">CA1,</span> <span class="hl kwc">yend</span> <span class="hl std">= vscores</span><span class="hl opt">$</span><span class="hl std">CA2),</span> <span class="hl kwc">arrow</span><span class="hl std">=</span><span class="hl kwd">arrow</span><span class="hl std">(</span><span class="hl kwc">length</span><span class="hl std">=</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">0.2</span><span class="hl std">,</span><span class="hl str">&quot;cm&quot;</span><span class="hl std">)),</span>
                                   <span class="hl kwc">alpha</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">'black'</span><span class="hl std">)</span><span class="hl opt">+</span> <span class="hl kwd">geom_label</span><span class="hl std">(</span><span class="hl kwc">data</span><span class="hl std">=vscores,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=CA1,</span> <span class="hl kwc">y</span><span class="hl std">=CA2,</span> <span class="hl kwc">label</span> <span class="hl std">= env)))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-8-1.png" title="plot of chunk unnamed-chunk-8" alt="plot of chunk unnamed-chunk-8" class="plot" /></div></div>

</body>
</html>
